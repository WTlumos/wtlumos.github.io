<!DOCTYPE html>
<html lang="zh-CN,en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wtlumos.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"gitalk":{"order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="webpack.config.js的各种配置：entry，module，plugins，devServer，devtool，mode，resolve">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue学习笔记03-webpack搭建Vue环境">
<meta property="og:url" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/index.html">
<meta property="og:site_name" content="W.T.的博客">
<meta property="og:description" content="webpack.config.js的各种配置：entry，module，plugins，devServer，devtool，mode，resolve">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/webpack.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/cli.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/bundle.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/plugin.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/ejs.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/babel1.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/babel2.png">
<meta property="og:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/hmr.png">
<meta property="article:published_time" content="2020-10-05T08:16:20.000Z">
<meta property="article:modified_time" content="2023-04-15T08:17:30.036Z">
<meta property="article:author" content="Wang Ting">
<meta property="article:tag" content="js">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/webpack.png">

<link rel="canonical" href="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Vue学习笔记03-webpack搭建Vue环境 | W.T.的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">W.T.的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Every day to be a little better</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        
            
  <li class="menu-item menu-item-books">
      
    

    <a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i>书单</a>

  </li>


      
        <li class="menu-item menu-item-route">
      
    

    <a href="/route/" rel="section"><i class="fas fa-route fa-fw"></i>学习路线</a>

  </li>
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-language">

    <a href="/en" rel="section"><i class="fas fa-language fa-fw"></i>English</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/WTlumos" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wang Ting">
      <meta itemprop="description" content="技术成长笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="W.T.的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Vue学习笔记03-webpack搭建Vue环境
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-05 16:16:20" itemprop="dateCreated datePublished" datetime="2020-10-05T16:16:20+08:00">2020-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-15 16:17:30" itemprop="dateModified" datetime="2023-04-15T16:17:30+08:00">2023-04-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>46k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>42 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote class="blockquote-center">webpack.config.js的各种配置：entry，module，plugins，devServer，devtool，mode，resolve</blockquote>

<span id="more"></span>

<h1 id="基础认知">1. 基础认知</h1><p><a href="/2020/06/23/webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">webpack学习笔记</a></p>
<ul>
<li><p>事实上随着前端的快速发展，目前前端的开发已经变的越来越复杂了</p>
<ul>
<li>比如开发过程中需要通过 <code>模块化的方式 </code>来开发;</li>
<li>比如也会使用一些 <code>高级的特性来加快开发效率或者安全性</code>，比如通过ES6+、TypeScript开发脚本逻辑， 通过sass、less等方式来编写css样式代码;</li>
<li>比如开发过程中，希望 <code>实时的监听文件的变化</code>来并且<code>反映到浏览器</code>上，提高开发的效率; </li>
<li>比如开发完成后还需要<code>将代码进行压缩、合并以及其他相关的优化</code>;</li>
<li>等等….</li>
</ul>
</li>
<li><p>但是对于很多的<strong>前端开发者</strong>来说，并不需要思考这些问题，日常的开发中根本就没有面临这些问题: </p>
<ul>
<li><p>这是因为目前前端开发我们通常都会直接使用三大框架来开发：<code>Vue、React、Angular</code>;</p>
</li>
<li><p>但是事实上，这三大框架的创建过程都是 <code>借助于脚手架(CLI)</code>的;</p>
</li>
<li><p>事实上Vue-CLI、create-react-app、Angular-CLI都是<code>基于webpack</code>支持模块化、less、 TypeScript、打包优化等的;</p>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/webpack.png"></p>
</li>
</ul>
</li>
</ul>
<h2 id="Webpack到底是什么呢">1.1. Webpack到底是什么呢?</h2><ul>
<li><p>官方的解释:</p>
<p><code>webpack is a static module bundler for modern JavaScript applications.</code></p>
</li>
<li><p><strong>webpack是一个静态的模块化打包工具，为现代的JavaScript应用程序;</strong></p>
</li>
<li><p>对上面的解释进行拆解:</p>
<ul>
<li><code>打包bundler</code>：webpack可以将代码进行打包，所以它是一个打包工具</li>
<li><code>静态的static</code>：这样表述的原因是我们最终可以将代码打包成最终的静态资源(部署到静态服务器);</li>
<li><code>模块化module</code>：webpack默认支持各种模块化开发，ES Module、CommonJS、AMD等;</li>
<li><code>现代的modern</code>：正是因为现代前端开发面临各种各样的问题，才催生了webpack的出现和发展;</li>
</ul>
</li>
</ul>
<h2 id="Webpack的使用前提">1.2. Webpack的使用前提</h2><ul>
<li><p>webpack的官方文档是<a target="_blank" rel="noopener" href="https://webpack.js.org/">https://webpack.js.org/</a> </p>
<ul>
<li>webpack的中文官方文档是<a target="_blank" rel="noopener" href="https://webpack.docschina.org/">https://webpack.docschina.org/</a> </li>
<li>DOCUMENTATION:文档详情，也是我们最关注的</li>
</ul>
</li>
<li><p>Webpack的运行是依赖Node环境的</p>
<ul>
<li>所以需要先安装Node.js，并且同时会安装npm;(也可以使用nvm或者n来管理Node版本); </li>
<li>Node官方网站:<a target="_blank" rel="noopener" href="https://nodejs.org/">https://nodejs.org/</a></li>
</ul>
</li>
</ul>
<h2 id="Webpack的安装">1.3. Webpack的安装</h2><ul>
<li><p>webpack的安装目前分为两个：<code>webpack、webpack-cli</code></p>
</li>
<li><p>那么它们是什么关系呢?</p>
<ul>
<li><p>执行webpack命令，会执行node_modules下的.bin目录下的webpack;</p>
</li>
<li><p>webpack在执行时是依赖webpack-cli的，如果没有安装就会报错;</p>
</li>
<li><p>而webpack-cli中代码执行时，才是真正利用webpack进行编译和打包的过程;</p>
</li>
<li><p>所以在安装webpack时，需要同时安装webpack-cli(第三方的脚手架事实上是没有使用webpack-cli的，而是类似于自己的vue-service-cli的东西)</p>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/cli.png"></p>
</li>
</ul>
</li>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">npm install webpack webpack-cli –g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部安装</span></span><br><span class="line">npm install webpack webpack-cli --save-dev </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Webpack的默认打包">1.4. Webpack的默认打包</h2><ul>
<li><p>通过webpack进行打包，之后运行打包之后的代码 </p>
<ul>
<li>在目录下直接执行 <code>webpack</code> 命令</li>
</ul>
</li>
<li><p><strong>生成一个dist文件夹，里面存放一个main.js的文件，就是打包之后的文件:</strong></p>
<ul>
<li>这个文件中的代码被压缩了;</li>
<li>代码中依然存在ES6的语法，比如箭头函数、const等，这是因为默认情况下webpack并不清楚打包后的文件是否需要转成ES5之前的语法，需要通过babel来进行转换和设置;</li>
</ul>
</li>
<li><p>代码是可以正常进行打包的，但是有一个问题，webpack是如何确定入口的呢?</p>
<ul>
<li>事实上，当运行webpack时，webpack会查找当前目录下的 src&#x2F;index.js作为入口; </li>
<li>所以，如果当前项目中没有存在src&#x2F;index.js文件，那么会报错;</li>
</ul>
</li>
<li><p>当然，也可以通过配置来指定入口和出口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --entry ./src/main.js --output-path ./build</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="实验代码">2. 实验代码</h1><h2 id="创建package-json文件">2.1. 创建package.json文件</h2><p>用于管理项目的信息、库依赖等</p>
<p>定位到项目根目录下，运行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>



<h2 id="安装webpack">2.2. 安装webpack</h2><p>–save-dev 特指开发环境下的安装包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure>



<h2 id="创建文件">2.3. 创建文件</h2><p>根目录下创建文件夹src，src中创建文件夹js，js中创建 math.js 和 format.js，src目录下创建index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//===============/src/js/math.js====================</span></span><br><span class="line"><span class="comment">// ES Module</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1,num2</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> num1+num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//===============/src/js/format.js==================</span></span><br><span class="line"><span class="keyword">const</span> priceFormat = <span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;¥&quot;</span>+num;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// CommonJS</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    priceFormat</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//===============/src/index.js==================</span></span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&#x27;./js/math&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;priceFormat&#125; = <span class="built_in">require</span>(<span class="string">&quot;./js/format&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">priceFormat</span>(<span class="number">99.8</span>));</span><br></pre></td></tr></table></figure>



<h2 id="创建scripts脚本">2.4. 创建scripts脚本</h2><p>package.json 中</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="执行脚本命令">2.5. 执行脚本命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>会在根目录下生成dist文件夹，代码浓缩在main.js中，调用 dist&#x2F;main.js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="Webpack配置文件">3. Webpack配置文件</h1><ul>
<li>在通常情况下，webpack需要打包的项目是非常复杂的，并且需要一系列的配置来满足要求，默认配置必然 是不可以的。</li>
<li>可以在根目录下创建一个webpack.config.js文件，来作为webpack的配置文件:</li>
<li>继续执行 <code>npm run build</code>命令，依然可以正常打包</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node 内置核心模块，用来处理路径问题</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//入口文件</span></span><br><span class="line">	<span class="attr">entry</span>: <span class="string">&#x27;./src/js/index.js&#x27;</span>, </span><br><span class="line">  <span class="comment">//输出配置</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出文件路径配置</span></span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(_dirname,<span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">  <span class="comment">//开发环境</span></span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h1 id="指定配置文件">4. 指定配置文件</h1><ul>
<li><p>如果配置文件并不是webpack.config.js的名字，而是其他的名字呢? </p>
<ul>
<li>比如将webpack.config.js修改成了 wk.config.js; </li>
<li>这个时候可以通过 –config 来指定对应的配置文件;</li>
</ul>
</li>
<li><p>但是每次这样执行命令来对源码进行编译，会非常繁琐，所以可以在package.json中增加一个新的脚本:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config wk.config.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Webpack的依赖图">5. Webpack的依赖图</h1><p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/bundle.png"></p>
<ul>
<li>webpack到底是如何对项目进行打包的呢?<ul>
<li>事实上webpack在处理应用程序时，它会根据命令或者配置文件找到入口文件;</li>
<li>从入口开始，会生成一个 依赖关系图，这个依赖关系图会包含应用程序中所需的所有模块(比如.js文件、css文件、图片、字 体等);</li>
<li>然后遍历图结构，打包一个个模块(根据文件的不同使用不同的loader来解析);</li>
</ul>
</li>
</ul>
<h1 id="Vue项目加载的文件有哪些呢">6. Vue项目加载的文件有哪些呢?</h1><ul>
<li><p>JavaScript的打包:</p>
</li>
<li><p>将ES6转换成ES5的语法;</p>
</li>
<li><p>TypeScript的处理，将其转换成JavaScript;</p>
</li>
<li><p>Css的处理:</p>
<ul>
<li>CSS文件模块的加载、提取;</li>
<li>Less、Sass等预处理器的处理;</li>
</ul>
</li>
<li><p>资源文件img、font:</p>
<ul>
<li>图片img文件的加载; </li>
<li>字体font文件的加载;</li>
</ul>
</li>
<li><p>HTML资源的处理:</p>
<ul>
<li>打包HTML资源文件;</li>
</ul>
</li>
<li><p>处理vue项目的SFC文件</p>
<ul>
<li>.vue文件;</li>
</ul>
</li>
</ul>
<h1 id="编写案例代码">7. 编写案例代码</h1><ul>
<li>创建一个component.js<ul>
<li>通过JavaScript创建了一个元素，并且希望给它设置一些样式;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/style.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    div.<span class="property">innerHTML</span> = <span class="string">&quot;Hello webpack&quot;</span>;</span><br><span class="line">    div.<span class="property">className</span> = <span class="string">&quot;title&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(<span class="title function_">add</span>());</span><br></pre></td></tr></table></figure>



<p>此时，需要将 component.js 引入 index.js 的依赖中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;priceFormat&#125; = <span class="built_in">require</span>(<span class="string">&quot;./format&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">priceFormat</span>(<span class="number">99.8</span>));</span><br></pre></td></tr></table></figure>



<p>运行 <code>npm run build</code> 仍不行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="keyword">in</span> ./src/css/style.css 1:0</span><br><span class="line">Module parse failed: Unexpected token (1:0)</span><br><span class="line">You may need an appropriate loader to handle this file <span class="built_in">type</span>, currently no loaders are configured to process this file. See https://webpack.js.org/concepts<span class="comment">#loaders</span></span><br></pre></td></tr></table></figure>



<h2 id="css-loader的使用">7.1. css-loader的使用</h2><ul>
<li><p>此时需要一个loader来加载这个css文件，但是<strong>loader</strong>是什么呢?</p>
<ul>
<li>loader 可以用于对模块的源代码进行转换; </li>
<li>可以将css文件也看成是一个模块，通过import来加载这个模块的;</li>
<li>在加载这个模块时，webpack其实并不知道如何对其进行加载，必须制定对应的loader来完成这个功能;</li>
</ul>
</li>
<li><p>那么需要一个什么样的loader呢?</p>
<ul>
<li>对于加载css文件来说，需要一个可以读取css文件的loader; </li>
<li>这个loader最常用的是css-loader;</li>
</ul>
</li>
<li><p>css-loader的安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-loader -D</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="css-loader的使用方案">7.2. css-loader的使用方案</h2><ul>
<li>如何使用这个loader来加载css文件呢? 有三种方式:<ul>
<li>内联方式;</li>
<li>CLI方式(webpack5中不再使用);</li>
<li>配置方式;</li>
</ul>
</li>
</ul>
<h3 id="内联方式">7.2.1. 内联方式</h3><p>内联方式使用较少，因为不方便管理;</p>
<p>在引入的样式前加上使用的loader，并且使用!分割;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;css-loader!../css/style.css&quot;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="CLI方式">7.2.2. CLI方式</h3><ul>
<li>webpack5的文档中已经没有了–module-bind; </li>
<li>实际应用中也比较少使用，因为不方便管理;</li>
</ul>
<h3 id="配置方式">7.2.3. 配置方式</h3><ul>
<li><p>配置方式表示的意思是在webpack.config.js文件中写明配置信息:</p>
<ul>
<li>module.rules中允许配置多个loader); </li>
<li>这种方式可以更好的表示loader的配置，也方便后期的维护，同时也对各个Loader有一个全局的概览;</li>
</ul>
</li>
<li><p><strong>module.rules的配置如下:</strong></p>
</li>
<li><p>rules属性对应的值是一个数组：<code>[rules]</code></p>
</li>
<li><p>数组中存放的是一个个的rule，Rule是一个对象，对象中可以设置多个属性:</p>
<ul>
<li><code>test属性</code>：用于对 resource(资源)进行匹配的，通常会设置成正则表达式; </li>
<li><code>use属性</code>：对应的值时一个数组：<code>[UseEntry]</code><ul>
<li><p>UseEntry是一个对象，可以通过对象的属性来设置一些其他属性</p>
<ul>
<li><code>loader</code>：必须有一个 loader属性，对应的值是一个字符串;</li>
<li><code>options</code>：可选的属性，值是一个字符串或者对象，值会被传入到loader中; </li>
<li><code>query</code>：目前已经使用options来替代;</li>
</ul>
</li>
<li><p>传递字符串（如:use: [ ‘style-loader’ ]）是 loader 属性的简写方式(如:use: [ { loader: ‘style-loader’} ]);</p>
</li>
</ul>
</li>
<li><code>loader属性</code>：rules.use: [ { loader } ] 的简写。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="comment">//入口文件</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 输出文件名</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 输出文件路径配置</span></span><br><span class="line">        <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build/js&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 语法糖</span></span><br><span class="line">                <span class="comment">// loader: &#x27;css-loader&#x27;,</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 完整写法</span></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * use: [</span></span><br><span class="line"><span class="comment">                 *  &#123;loader: &#x27;css-loader&#x27;,options:&#123;&#125;&#125;</span></span><br><span class="line"><span class="comment">                 * ]</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line"></span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="style-loader">7.3. style-loader</h2><ul>
<li><p>通过css-loader加载了css文件，但是css在代码中并没有生效(页面没有效果)。</p>
</li>
<li><p>这是为什么呢?</p>
<ul>
<li>因为css-loader只是负责将.css文件进行解析，并不会将解析之后的css插入到页面中;</li>
<li>如果希望再完成插入style的操作，那么还需要style-loader;</li>
</ul>
</li>
</ul>
<h3 id="安装style-loader">7.3.1. 安装style-loader</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i style-loader -D</span><br></pre></td></tr></table></figure>



<h3 id="配置style-loader">7.3.2. 配置style-loader</h3><ul>
<li><p>如何使用style-loader:</p>
<ul>
<li>在配置文件中，添加style-loader;</li>
<li>注意：因为loader的执行顺序是从下到上，所以需要将style-loader写到css-loader的前面;</li>
</ul>
</li>
<li><p>重新执行编译npm run build，可以发现打包后的css已经生效了:</p>
<ul>
<li>目前css是通过页内样式的方式添加进来的;</li>
<li>应该将css抽取到单独的文件中，并且进行压缩等操作;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="comment">//入口文件</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 输出文件名</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 输出文件路径配置</span></span><br><span class="line">        <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build/js&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>到此，在index.html中引入 <code>build/js/index.js</code> 就可以显示div和其样式</p>
<h2 id="如何处理less文件">7.4. 如何处理less文件?</h2><ul>
<li><p>在开发中，可能会使用less、sass、stylus的预处理器来编写css样式，效率会更高</p>
</li>
<li><p>那么，如何可以让环境支持这些预处理器呢?</p>
<ul>
<li>首先需要确定，less、sass等编写的css需要通过工具转换成普通的css;</li>
</ul>
</li>
<li><p>比如编写如下的less样式:</p>
<p><code>src/css/content.less</code></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@fontSize:</span> <span class="number">30px</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="variable">@fontSize</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入component.js中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/style.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/content.less&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    div.<span class="property">innerHTML</span> = <span class="string">&quot;Hello webpack&quot;</span>;</span><br><span class="line">    div.<span class="property">className</span>=<span class="string">&quot;title content&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(<span class="title function_">add</span>());</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Less工具处理">7.4.1. Less工具处理</h3><p>使用less工具来完成它的编译转换: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install less -D</span><br></pre></td></tr></table></figure>

<p>执行如下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx lessc ./src/css/title.less title.css</span><br></pre></td></tr></table></figure>

<p>或者使用vscode插件 <code>Easy Less</code> - Auto-compile LESS to CSS on save</p>
<h3 id="less-loader处理">7.4.2. less-loader处理</h3><ul>
<li><p>但是在项目中会编写大量的css，它们如何可以自动转换呢?</p>
<ul>
<li><p>可以使用less-loader，来自动使用less工具转换less到css;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install less-loader -D</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="comment">//入口文件</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 输出文件名</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 输出文件路径配置</span></span><br><span class="line">        <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build/js&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;less-loader&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行命令，less就自动转换成css，并且页面也会生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="PostCSS-兼容性">8. PostCSS 兼容性</h1><ul>
<li><p>什么是PostCSS呢?</p>
<ul>
<li>PostCSS是一个通过JavaScript来转换样式的工具;</li>
<li>这个工具可以进行一些CSS的转换和适配，比如 <code>自动添加浏览器前缀</code>、<code>css样式的重置</code>; </li>
<li>但是实现这些功能，需要借助于PostCSS对应的插件;</li>
</ul>
</li>
<li><p>如何使用PostCSS呢?</p>
<ol>
<li>第一步:查找PostCSS在构建工具中的扩展，比如webpack中的postcss-loader; </li>
<li>第二步：选择需要添加PostCSS相关的插件;</li>
</ol>
</li>
</ul>
<h2 id="命令行使用postcss">8.1. 命令行使用postcss</h2><ul>
<li><p>安装：postcss、postcss-cli</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss postcss-cli -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写一个需要添加前缀的css:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://autoprefixer.github.io/">https://autoprefixer.github.io/</a> </p>
</li>
<li><p>在上面的网站中查询一些添加css属性的样式;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:fullscreen</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">  use-select: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="插件autoprefixer">8.2. 插件autoprefixer</h2><ul>
<li><p>安装autoprefixer:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i autoprefixer -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接使用使用postcss工具，并且制定使用autoprefixer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx postcss --use autoprefixer -o end.css ./src/css/style.css</span><br></pre></td></tr></table></figure>
</li>
<li><p>转化之后的css样式如下:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">:-webkit-full-screen&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:fullscreen</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">    -webkit-user-select: none;</span><br><span class="line">       -moz-user-select: none;</span><br><span class="line">            user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jc3Mvc3R5bGUuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOztBQUZBOztBQUVBOztBQUVBO0lBQ0kseUJBQWlCO09BQWpCLHNCQUFpQjtZQUFqQixpQkFBaUI7QUFDckIiLCJmaWxlIjoiZW5kLmNzcyIsInNvdXJjZXNDb250ZW50IjpbIjpmdWxsc2NyZWVue1xuICAgIFxufVxuXG4udGl0bGV7XG4gICAgdXNlci1zZWxlY3Q6IG5vbmU7XG59Il19 */</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="postcss-loader">8.3. postcss-loader</h2><p><a target="_blank" rel="noopener" href="https://github.com/postcss/postcss">https://github.com/postcss/postcss</a></p>
<ul>
<li><p>真实开发中必然不会直接使用命令行工具来对css进行处理，而是可以借助于构建工具: </p>
<ul>
<li>在webpack中使用postcss就是使用postcss-loader来处理的;</li>
</ul>
</li>
<li><p>我们来安装postcss-loader:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i postcss-loader -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改加载css的loader:</p>
<ul>
<li><p>注意：因为postcss需要有对应的插件才会起效果，所以需要配置它的plugin;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>:&#123;</span><br><span class="line">                <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                    <span class="attr">plugins</span>: [</span><br><span class="line">                        <span class="built_in">require</span>(<span class="string">&quot;autoprefixer&quot;</span>)</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="单独的postcss配置文件">8.4. 单独的postcss配置文件</h2><ul>
<li><p>当然，可以将配置信息放到一个单独的文件中进行管理:</p>
<ul>
<li><p>在根目录下创建postcss.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">&quot;autoprefixer&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 webpack.config.js 中加载 postcss-loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">      <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">      <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="string">&quot;postcss-loader&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="postcss-preset-env">8.5. postcss-preset-env</h2><ul>
<li><p>事实上，在配置postcss-loader时，并不需要使用autoprefixer。</p>
</li>
<li><p>可以使用另外一个插件：<code>postcss-preset-env</code></p>
<ul>
<li>postcss-preset-env也是一个postcss的插件;</li>
<li>它可以将一些现代的CSS特性，转成大多数浏览器认识的CSS，并且会根据目标浏览器或者运行时环境添加所需的polyfill;</li>
<li>也包括会<code>自动添加autoprefixer</code>;</li>
</ul>
</li>
<li><p>首先，安装postcss-preset-env:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss-preset-env -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后，修改掉之前的autoprefixer即可:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/csstools/postcss-preset-env">https://github.com/csstools/postcss-preset-env</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postcssPresetEnv = <span class="built_in">require</span>(<span class="string">&#x27;postcss-preset-env&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">postcssPresetEnv</span>(&#123;</span><br><span class="line">        <span class="attr">browsers</span>: <span class="string">&#x27;last 4 versions&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行命令 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p>得到兼容的css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    <span class="attribute">display</span>: -ms-flexbox;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">  -webkit-user-select: none;</span><br><span class="line">     -moz-user-select: none;</span><br><span class="line">      -ms-user-select: none;</span><br><span class="line">          user-select: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="打包图片">9. 打包图片</h1><ul>
<li>在项目中使用图片，比较常见的使用图片的方式是两种: <ul>
<li>img元素，<code>设置src属性</code>;</li>
<li>其他元素(比如div)，<code>设置background-image的css属性</code>;</li>
</ul>
</li>
</ul>
<p><code>src/js/component.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/style.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/content.less&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> img1 <span class="keyword">from</span> <span class="string">&#x27;../img/1.jpg&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> img2 <span class="keyword">from</span> <span class="string">&#x27;../img/2.jpeg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">src</span> = img1;</span><br><span class="line">    div.<span class="title function_">appendChild</span>(img);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> div2 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    div2.<span class="property">style</span>.<span class="property">width</span>=<span class="number">50</span>+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    div2.<span class="property">style</span>.<span class="property">height</span>=<span class="number">50</span>+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    div2.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&#x27;url(&#x27;</span>+img2+<span class="string">&#x27;) no-repeat center&#x27;</span>;</span><br><span class="line">    div.<span class="title function_">appendChild</span>(div2);</span><br><span class="line"></span><br><span class="line">    div.<span class="property">className</span> = <span class="string">&quot;title&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(<span class="title function_">add</span>());</span><br></pre></td></tr></table></figure>



<h2 id="file-loader">9.1. file-loader</h2><ul>
<li><p>要处理jpg、png等格式的图片，使用 file-loader：</p>
<ul>
<li>file-loader的作用就是处理 import&#x2F;require()方式引入的一个文件资源，并且会将它放到输出的文件夹中;</li>
</ul>
</li>
<li><p>安装file-loader:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i file-loader -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置处理图片的rule:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">   <span class="attr">use</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="comment">// 这个属性如果没有设置，会生成多张图片</span></span><br><span class="line">   <span class="attr">type</span>: <span class="string">&#x27;javascript/auto&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="文件的命名规则">9.2. 文件的命名规则</h2><ul>
<li><p>处理后的文件名称按照一定的规则进行显示:</p>
</li>
<li><p>比如保留原来的文件名、扩展名，同时为了防止重复，包含一个hash值等;</p>
</li>
<li><p>使用PlaceHolders来完成，webpack给我们提供了大量的PlaceHolders来显示不同的内容: </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/file-loader/#placeholders">https://webpack.js.org/loaders/file-loader/#placeholders</a></li>
</ul>
</li>
<li><p>最常用的placeholder:</p>
<ul>
<li><code>[ext]</code>：处理文件的扩展名;</li>
<li><code>[name]</code>：处理文件的名称;</li>
<li><code>[hash]</code>：文件的内容，使用MD4的散列函数处理，生成的一个128位的hash值(32个十六进制);</li>
<li><code>[contentHash]</code>：在file-loader中和[hash]结果是一致的; </li>
<li><code>[hash:&lt;length&gt;]</code>：截图hash的长度，默认32个字符太长了;</li>
<li><code>[path]</code>：文件相对于webpack配置文件的路径;</li>
</ul>
</li>
</ul>
<h2 id="设置文件的名称">9.3. 设置文件的名称</h2><ul>
<li>那么可以按照如下的格式编写: <ul>
<li>这个也是vue的写法;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;img/[name].[hash:8].[ext]&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;javascript/auto&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="设置文件的存放路径">9.4. 设置文件的存放路径</h2><ul>
<li>刚才通过 img&#x2F; 已经设置了文件夹，这个也是vue、react脚手架中常见的设置方式: <ul>
<li>其实按照这种设置方式就可以了;</li>
<li>当然也可以通过outputPath来设置输出的文件夹;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">                <span class="attr">outputPath</span>: <span class="string">&#x27;img&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;javascript/auto&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="url-loader">9.5. url-loader</h2><ul>
<li>url-loader 和 file-loader的工作方式是相似的，但是可以将较小的文件，转成 <code>base64的URI</code></li>
</ul>
<h3 id="安装url-loader">9.5.1. 安装url-loader:</h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader -D</span><br></pre></td></tr></table></figure>

<h3 id="配置文件">9.5.2. 配置文件</h3>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">                <span class="attr">outputPath</span>: <span class="string">&#x27;img&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>显示结果是一样的，并且图片可以正常显示;</p>
</li>
<li><p>但是在dist文件夹中，看不到图片文件:</p>
<ul>
<li><p>默认情况下url-loader会将所有的图片文件转成base64编码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/jpeg;base64,/9j/...//2Q==&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="url-loader的limit">9.5.3. url-loader的limit</h3><ul>
<li><p>开发中往往是小的图片需要转换，大的图片直接使用图片</p>
<ul>
<li>小的图片转换base64之后可以和页面一起被请求，减少不必要的请求过程; </li>
<li>而大的图片也进行转换，反而会影响页面的请求速度;</li>
</ul>
</li>
<li><p>如何<strong>限制哪些大小的图片转换和不转换</strong>呢?</p>
<ul>
<li>url-loader有一个options属性limit，可以用于设置转换的限制; </li>
<li>下面的代码 8kb以下的图片会进行base64编码;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">                <span class="attr">outputPath</span>: <span class="string">&#x27;img&#x27;</span>,</span><br><span class="line">                <span class="attr">limit</span>: <span class="number">8</span>*<span class="number">1024</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="asset-module-type">9.6. asset module type</h2><ul>
<li><p>在webpack5之前，加载资源需要使用一些loader，比如raw-loader 、url-loader、file-loader; </p>
</li>
<li><p>在webpack5开始，我们可以直接使用资源模块类型(asset module type)，来替代上面的这些loader;</p>
</li>
<li><p>资源模块类型(asset module type)**，通过添加 4 种新的模块类型，来替换所有这些 loader: **</p>
<ul>
<li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现; </li>
<li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现; </li>
<li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现;</li>
<li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现;</li>
</ul>
</li>
</ul>
<h3 id="使用">9.6.1. 使用</h3><ul>
<li><p>比如加载图片，可以使用下面的方式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|png|gif|svg)$/</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>但是，如何可以自定义文件的输出路径和文件名呢?</p>
<ol>
<li><p>方式一：修改output，添加assetModuleFilename属性;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出文件路径配置</span></span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build&quot;</span>),</span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&#x27;img/[name]_[hash:6][ext]&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">          <span class="attr">use</span>: [</span><br><span class="line">              <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">              <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">              <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">              <span class="string">&quot;less-loader&quot;</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：在rule中，添加一个generator属性，并且设置filename;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">    <span class="attr">generator</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;img/[name]_[hash:6][ext]&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="url-loader的limit效果">9.6.2. url-loader的limit效果</h3><ul>
<li>需要两个步骤来实现:<ol>
<li>步骤一：将type修改为asset;</li>
<li>步骤二：添加一个parser属性，并且制定dataUrl的条件，添加maxSize属性;</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|gif|png|svg)$/</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">    <span class="attr">generator</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;img/[name]_[hash:6][ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">parser</span>: &#123;</span><br><span class="line">        <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">100</span>* <span class="number">1024</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="打包字体">10. 打包字体</h1><h2 id="加载字体文件">10.1. 加载字体文件</h2><ul>
<li><p>如果某些特殊的字体或者字体图标，会引入很多字体相关的文件，这些文件的处理也是一样的</p>
</li>
<li><p>从阿里图标库中下载了几个字体图标:</p>
<p><a target="_blank" rel="noopener" href="https://www.iconfont.cn/fonts/index">https://www.iconfont.cn/fonts/index</a></p>
</li>
<li><p>在component中引入，并且添加一个i元素用于显示字体图标:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/style.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../css/content.less&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> img1 <span class="keyword">from</span> <span class="string">&#x27;../img/1.jpg&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> img2 <span class="keyword">from</span> <span class="string">&#x27;../img/2.jpeg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../font/iconfont.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> iEle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;i&quot;</span>);</span><br><span class="line">    iEle.<span class="property">className</span>=<span class="string">&quot;iconfont icon-ashbin&quot;</span>;</span><br><span class="line">    div.<span class="title function_">appendChild</span>(iEle);</span><br><span class="line"></span><br><span class="line">    div.<span class="property">className</span> = <span class="string">&quot;title&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(<span class="title function_">add</span>());</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="字体的打包">10.2. 字体的打包</h2><ul>
<li>这个时候打包会报错，因为无法正确的处理eot、ttf、woff等文件:<ul>
<li>使用file-loader来处理，也可以直接使用webpack5的资源模块类型来处理;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(eot|ttf|woff|woff2)$/</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">    <span class="attr">generator</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;font/[name]_[hash:6][ext]&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Plugin">11. Plugin</h1><ul>
<li><p><strong>Webpack的另一个核心是Plugin，官方有这样一段对Plugin的描述</strong>:</p>
<p>While loaders are used to transform certain types of modules, plugins can be leveraged to perform a wider range of tasks like bundle optimization, asset management and injection of environment variables.</p>
</li>
<li><p>上面表达的含义翻译过来就是:</p>
<ul>
<li>Loader是用于<code>特定的模块类型</code>进行转换;</li>
<li>Plugin可以用于执行更加广泛的任务，比如打包优化、资源管理、环境变量注入等;</li>
</ul>
</li>
</ul>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/plugin.png"></p>
<h2 id="CleanWebpackPlugin">11.1. CleanWebpackPlugin</h2><ul>
<li><p>每次修改了一些配置，重新打包时，自动删除原文件夹 - CleanWebpackPlugin;</p>
</li>
<li><p>首先，安装这个插件: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i clean-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后在插件中配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">CleanWebpackPlugin</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">		<span class="attr">plugins</span>: [  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="HtmlWebpackPlugin">11.2. HtmlWebpackPlugin</h2><ul>
<li><p>另外还有一个<strong>不太规范</strong>的地方:</p>
<ul>
<li>目前HTML文件是编写在根目录下的，而最终打包的 build 文件夹中是没有index.html文件的</li>
<li>在进行项目部署的时，必然也是需要有对应的入口文件index.html;</li>
<li>所以需要对index.html进行打包处理;</li>
</ul>
</li>
<li><p>对HTML进行打包处理，使用插件:<strong>HtmlWebpackPlugin</strong>;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span>  = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;example&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="生成index-html分析">11.2.1. 生成index.html分析</h3><ul>
<li><p>现在自动在build文件夹中，生成了一个index.html的文件: </p>
<ul>
<li><p>该文件中也自动添加了打包的 index.js文件;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>这个文件是如何生成的呢?</p>
<ul>
<li><p>默认情况下是根据ejs的一个模板来生成的;</p>
</li>
<li><p>在html-webpack-plugin的源码中，有一个default_index.ejs模块;</p>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/ejs.png"></p>
</li>
</ul>
</li>
</ul>
<h3 id="自定义HTML模板">11.2.2. 自定义HTML模板</h3><ul>
<li><p>加入一些比较特别的内容:</p>
<ul>
<li>比如添加一个noscript标签，在用户的JavaScript被关闭时，给予响应的提示;</li>
<li>比如在开发vue或者react项目时，我们需要一个可以挂载后续组件的根标签 <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>;</li>
</ul>
</li>
<li><p>创建index.html模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; href=&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;noscript&gt;</span><br><span class="line">      &lt;strong&gt;</span><br><span class="line">        We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavasSript enabled. Please enable it to continue.</span><br><span class="line">      &lt;/strong&gt;</span><br><span class="line">    &lt;/noscript&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;!-- built files will be auto injected --&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="自定义模板数据填充">11.2.3. 自定义模板数据填充</h3><ul>
<li><p>一些类似这样的语法 <code>&lt;%= 变量 %&gt;</code>，是EJS模块填充数据的方式。</p>
</li>
<li><p>在配置HtmlWebpackPlugin时，我们可以添加如下配置:</p>
<ul>
<li><code>template</code>：指定我们要使用的模块所在的路径;</li>
<li><code>title</code>：在进行htmlWebpackPlugin.options.title读取时，就会读到该信息;</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span>  = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;public/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Hello Webpack&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="DefinePlugin">11.2.4. DefinePlugin</h3><ul>
<li><p>但是，这个时候编译还是会报错，因为模块中还使用到一个BASE_URL的常量:</p>
</li>
<li><p>这是因为在编译template模块时，有一个BASE_URL:</p>
<ul>
<li><code>&lt;link rel=&quot;icon&quot; href=&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;&gt;</code>;</li>
<li>但是并没有设置过这个常量值，所以会出现没有定义的错误;</li>
<li>这个时候可以使用DefinePlugin插件;</li>
</ul>
</li>
<li><p>DefinePlugin允许在编译时创建配置的全局常量，是一个webpack内置的插件(不需要单独安装):</p>
</li>
<li><p>这个时候，编译template就可以正确的编译了，会读取到BASE_URL的值;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">DefinePlugin</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">            <span class="attr">BASE_URL</span>: <span class="string">&quot;&#x27;./&#x27;&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="生成的index-html">11.2.5. 生成的index.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Webpack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><br><span class="line">        We&#x27;re sorry but Hello Webpack doesn&#x27;t work properly without JavasSript enabled. Please enable it to continue.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="CopyWebpackPlugin">11.3. CopyWebpackPlugin</h2><ul>
<li><p>在vue的打包过程中，如果将一些文件放到public的目录下，希望将这些内容复制到 build 文件夹中，使用CopyWebpackPlugin来完成;</p>
</li>
<li><p>安装CopyWebpackPlugin插件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i copy-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置CopyWebpackPlugin:</p>
<ul>
<li>复制的规则在patterns中设置;</li>
<li>from：设置从哪一个源中开始复制;</li>
<li>to：复制到的位置，可以省略，会默认复制到打包的目录下;</li>
<li>globOptions：设置一些额外的选项，其中可以编写需要忽略的文件:<ul>
<li>.DS_Store：mac目录下回自动生成的一个文件;</li>
<li>index.html:也不需要复制，因为我们已经通过HtmlWebpackPlugin完成了index.html的生成;</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CopyPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;copy-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [ </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">patterns</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">from</span>: <span class="string">&#x27;public&#x27;</span>,</span><br><span class="line">                    <span class="attr">globOptions</span>: &#123;</span><br><span class="line">                        <span class="attr">ignore</span>: [</span><br><span class="line">                            <span class="string">&#x27;**/.DS_Store&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;**/index.html&#x27;</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Mode配置">12. Mode配置</h1><ul>
<li><p>Mode配置选项，可以告知webpack使用响应模式的内置优化: </p>
<ul>
<li>默认值是 production; </li>
<li>可选值有:’none’ | ‘development’ | ‘production’;</li>
</ul>
</li>
<li><p>这几个选项有什么样的区别呢?</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>development</td>
<td>会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 development，为模块和chunk启用有效的名</td>
</tr>
<tr>
<td>production</td>
<td>会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production，为模块和chunk启用确定性的混淆名称，FlagDependencyUsagePlugin，FlagIncludeC混开始Plugin，ModuleConcatenationPlugin，NoEmitOnErrorsPlugin 和 TerserPlugin</td>
</tr>
<tr>
<td>none</td>
<td>不使用任何默认优化选项</td>
</tr>
</tbody></table>
</li>
<li><p>源码出错提示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 设置模式</span></span><br><span class="line">  <span class="comment">// development 开发阶段</span></span><br><span class="line">  <span class="comment">// production 打包上线阶段</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="comment">// 设置source-map，建立js映射文件，方便调试代码和错误</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Mode-development">12.1. Mode: development</h2><p><a target="_blank" rel="noopener" href="https://v4.webpack.js.org/configuration/mode/#mode-development">https://v4.webpack.js.org/configuration/mode/#mode-development</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.development.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">+ <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">- <span class="attr">devtool</span>: <span class="string">&#x27;eval&#x27;</span>,</span><br><span class="line">- <span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">- <span class="attr">performance</span>: &#123;</span><br><span class="line">-   <span class="attr">hints</span>: <span class="literal">false</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">output</span>: &#123;</span><br><span class="line">-   <span class="attr">pathinfo</span>: <span class="literal">true</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">optimization</span>: &#123;</span><br><span class="line">-   <span class="attr">namedModules</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">namedChunks</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">nodeEnv</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">-   <span class="attr">flagIncludedChunks</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">occurrenceOrder</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">sideEffects</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">usedExports</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">concatenateModules</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">-     <span class="attr">hidePathInfo</span>: <span class="literal">false</span>,</span><br><span class="line">-     <span class="attr">minSize</span>: <span class="number">10000</span>,</span><br><span class="line">-     <span class="attr">maxAsyncRequests</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">-     <span class="attr">maxInitialRequests</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">-   &#125;,</span><br><span class="line">-   <span class="attr">noEmitOnErrors</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">checkWasmTypes</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">minimize</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">removeAvailableModules</span>: <span class="literal">false</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">plugins</span>: [</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="title class_">NamedModulesPlugin</span>(),</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="title class_">NamedChunksPlugin</span>(),</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123; <span class="string">&quot;process.env.NODE_ENV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;development&quot;</span>) &#125;),</span><br><span class="line">- ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Mode-production">12.2. Mode: production</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.production.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">+  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">- <span class="attr">performance</span>: &#123;</span><br><span class="line">-   <span class="attr">hints</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">output</span>: &#123;</span><br><span class="line">-   <span class="attr">pathinfo</span>: <span class="literal">false</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">optimization</span>: &#123;</span><br><span class="line">-   <span class="attr">namedModules</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">namedChunks</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">nodeEnv</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">-   <span class="attr">flagIncludedChunks</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">occurrenceOrder</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">sideEffects</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">concatenateModules</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">-     <span class="attr">hidePathInfo</span>: <span class="literal">true</span>,</span><br><span class="line">-     <span class="attr">minSize</span>: <span class="number">30000</span>,</span><br><span class="line">-     <span class="attr">maxAsyncRequests</span>: <span class="number">5</span>,</span><br><span class="line">-     <span class="attr">maxInitialRequests</span>: <span class="number">3</span>,</span><br><span class="line">-   &#125;,</span><br><span class="line">-   <span class="attr">noEmitOnErrors</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">checkWasmTypes</span>: <span class="literal">true</span>,</span><br><span class="line">-   <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">plugins</span>: [</span><br><span class="line">-   <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(<span class="comment">/* ... */</span>),</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123; <span class="string">&quot;process.env.NODE_ENV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;production&quot;</span>) &#125;),</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="property">optimize</span>.<span class="title class_">ModuleConcatenationPlugin</span>(),</span><br><span class="line">-   <span class="keyword">new</span> webpack.<span class="title class_">NoEmitOnErrorsPlugin</span>()</span><br><span class="line">- ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Mode-none">12.3. Mode: none</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.custom.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">+ <span class="attr">mode</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">- <span class="attr">performance</span>: &#123;</span><br><span class="line">-  <span class="attr">hints</span>: <span class="literal">false</span></span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">optimization</span>: &#123;</span><br><span class="line">-   <span class="attr">flagIncludedChunks</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">occurrenceOrder</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">sideEffects</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">usedExports</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">concatenateModules</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">-     <span class="attr">hidePathInfo</span>: <span class="literal">false</span>,</span><br><span class="line">-     <span class="attr">minSize</span>: <span class="number">10000</span>,</span><br><span class="line">-     <span class="attr">maxAsyncRequests</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">-     <span class="attr">maxInitialRequests</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">-   &#125;,</span><br><span class="line">-   <span class="attr">noEmitOnErrors</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">checkWasmTypes</span>: <span class="literal">false</span>,</span><br><span class="line">-   <span class="attr">minimize</span>: <span class="literal">false</span>,</span><br><span class="line">- &#125;,</span><br><span class="line">- <span class="attr">plugins</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Babel">13. Babel</h1><h2 id="为什么需要babel">13.1. 为什么需要babel?</h2><ul>
<li><p>事实上，在开发中很少直接去接触babel，但是<strong>babel对于前端开发</strong>来说，目前是<strong>不可缺少的一部分</strong>: </p>
<ul>
<li>开发中，想要使用ES6+的语法，想要使用TypeScript，开发React项目，它们都是离不开Babel的; </li>
<li>学习Babel对于理解代码从编写到线上的转变过程至关重要;</li>
</ul>
</li>
<li><p>那么，Babel到底是什么呢?</p>
<ul>
<li><p>Babel是一个工具链，主要用于旧浏览器或者环境中将ECMAScript 2015+代码转换为向后兼容版本的JavaScript;</p>
</li>
<li><p>包括:语法转换、源代码转换等;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(item););</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Babel命令行使用">13.2. Babel命令行使用</h2><ul>
<li><p>babel本身可以作为 <code>一个独立的工具</code> (和postcss一样)，不和webpack等构建工具配置来单独使用</p>
</li>
<li><p>如果希望在命令行尝试使用babel，需要安装如下库: </p>
<ul>
<li><p><code>@babel/core</code>：babel的核心代码，必须安装;</p>
</li>
<li><p><code>@babel/cli</code>：可以在命令行使用babel;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/cli @babel/core -D</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用babel来处理源代码:</p>
</li>
<li><p><code>src</code>：是源文件的目录;</p>
</li>
<li><p><code>--out-dir</code>：指定要输出的文件夹dist;</p>
</li>
<li><p><code>--out-file</code>：指定要输出的文件;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx babel src --out-dir dist</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="插件的使用">13.3. 插件的使用</h2><ul>
<li><p>需要转换箭头函数，那么就可以使用 <code>箭头函数转换相关的插件</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-transform-arrow-functions -D</span><br><span class="line"></span><br><span class="line">npx babel src/js/math.js --out-dir dist --plugins=@babel/plugin-transform-arrow-functions</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看转换后的结果:</p>
<ul>
<li><p>const 并没有转成 var</p>
</li>
<li><p>这是因为 plugin-transform-arrow-functions，并没有提供这样的功能; </p>
</li>
<li><p>需要使用 plugin-transform-block-scoping 来完成这样的功能;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-transform-block-scoping -D</span><br><span class="line"></span><br><span class="line">npx babel src/js/math.js --out-file math.js --plugins=@babel/plugin-transform-arrow-functions,@babel/plugin-transform-block-scoping</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Babel的预设preset">13.4. Babel的预设preset</h2><ul>
<li><p>但是如果要转换的内容过多，一个个设置是比较麻烦的，可以使用预设(preset)</p>
</li>
<li><p>安装@babel&#x2F;preset-env预设: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/preset-env -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行如下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx babel src/js/math.js --out-file math.js --presets=@babel/preset-env</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Babel的底层原理">13.5. Babel的底层原理</h2><ul>
<li><p>babel是如何做到将一段代码（ES6、TypeScript、React）<code>转成</code> 另外一段代码（ES5）的呢? </p>
<ul>
<li>从一种源代码(原生语言)转换成另一种源代码(目标语言)，这是什么的工作呢?</li>
<li>就是 <code>编译器</code>，事实上可以将babel看成就是一个编译器。</li>
<li>Babel编译器的作用就是将源代码，转换成浏览器可以直接识别的另外一段源代码;</li>
</ul>
</li>
<li><p>Babel也拥有编译器的工作流程:</p>
<ul>
<li>解析阶段(Parsing)</li>
<li>转换阶段(Transformation) </li>
<li>生成阶段(Code Generation)</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/the-super-tiny-compiler">https://github.com/jamiebuilds/the-super-tiny-compiler</a></p>
</li>
</ul>
<h2 id="Babel编译器执行原理">13.6. Babel编译器执行原理</h2><ul>
<li><p>Babel的执行阶段</p>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/babel1.png"></p>
</li>
<li><p>当然，这只是一个简化版的编译器工具流程，在每个阶段又会有自己具体的工作</p>
<p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/babel2.png"></p>
</li>
</ul>
<h2 id="babel-loader">13.7. babel-loader</h2><ul>
<li><p>在实际开发中，通常会在构建工具中通过配置babel来对其进行使用的，比如在webpack中</p>
</li>
<li><p>安装相关的依赖:</p>
<ul>
<li><p>如果之前已经安装了@babel&#x2F;core，那么这里不需要再次安装; </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>可以设置一个规则，在加载js文件时，使用babel:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="指定使用的插件">13.8. 指定使用的插件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                   <span class="attr">plugins</span>: [</span><br><span class="line">                     <span class="string">&quot;@babel/plugin-transform-arrow-functions&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;@babel/plugin-transform-block-scoping&quot;</span></span><br><span class="line">                   ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="babel-preset">13.9. babel-preset</h2><ul>
<li><p>如果一个个去安装使用插件，那么需要手动来管理大量的babel插件，可以直接给webpack提供一个 preset，webpack会根据我们的预设来加载对应的插件列表，并且将其传递给babel</p>
</li>
<li><p>比如常见的预设有三个: </p>
<ul>
<li>env</li>
<li>react</li>
<li>TypeScript</li>
</ul>
</li>
<li><p>安装preset-env:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/preset-env</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                    <span class="attr">presets</span>: [</span><br><span class="line">                        <span class="string">&quot;@babel/preset-env&quot;</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Babel的配置文件">13.10. Babel的配置文件</h2><ul>
<li><p>可以将babel的配置信息放到一个独立的文件中，babel提供了两种配置文件的编写: </p>
<ul>
<li><code>babel.config</code>.json(或者.js，.cjs，.mjs)文件;</li>
<li><code>.babelrc</code>.json(或者.babelrc，.js，.cjs，.mjs)文件;</li>
</ul>
</li>
<li><p>它们两个有什么区别呢?</p>
<ul>
<li>目前很多的项目都采用了多包管理的方式(babel本身、element-plus、umi等); </li>
<li><code>.babelrc.json</code>：早期使用较多的配置方式，但是对于配置Monorepos项目是比较麻烦的;</li>
<li><code>babel.config</code>.json(babel7)：可以直接作用于Monorepos项目的子包，更加推荐;</li>
</ul>
</li>
</ul>
<p>根目录下新建 <code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Vue打包">14. Vue打包</h1><h2 id="Vue源码的打包">14.1. Vue源码的打包</h2><ul>
<li><p>安装插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue@next</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写代码</p>
<p><code>src/js/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;`</span>,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Hello Vue&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p>界面上是没有效果的:</p>
<ul>
<li><p>并且查看运行的控制台，会发现如下的警告信息;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runtime-core.esm-bundler.js:38 [Vue warn]: Component provided template option but runtime compilation is not supported <span class="keyword">in</span> this build of Vue. Configure your bundler to <span class="built_in">alias</span> <span class="string">&quot;vue&quot;</span> to <span class="string">&quot;vue/dist/vue.esm-bundler.js&quot;</span>. </span><br><span class="line">  at &lt;App&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Vue打包后不同版本解析">14.2. Vue打包后不同版本解析</h2><ul>
<li><p><code>vue(.runtime).global(.prod).js</code></p>
<ul>
<li>通过浏览器中的 <code>&lt;script src=&quot;...&quot;&gt;</code> 直接使用;</li>
<li>通过CDN引入和下载的Vue版本就是这个版本; </li>
<li>会暴露一个全局的Vue来使用;</li>
</ul>
</li>
<li><p><code>vue(.runtime).esm-browser(.prod).js</code></p>
<ul>
<li>用于通过原生 ES 模块导入使用 (在浏览器中通过 <code>&lt;script type=&quot;module&quot;&gt;</code> 来使用)</li>
</ul>
</li>
<li><p><code>vue(.runtime).esm-bundler.js</code></p>
<ul>
<li>用于 webpack，rollup 和 parcel 等构建工具;</li>
<li>构建工具中默认是vue.runtime.esm-bundler.js;</li>
<li>如果需要解析模板template，那么需要手动指定vue.esm-bundler.js;</li>
</ul>
</li>
<li><p><code>vue.cjs(.prod).js</code></p>
<ul>
<li>服务器端渲染使用;</li>
<li>通过require()在Node.js中使用;</li>
</ul>
</li>
</ul>
<h2 id="运行时-编译器-vs-仅运行时">14.3. 运行时+编译器 vs 仅运行时</h2><ul>
<li><p>在Vue的开发过程中有 <code>三种方式</code> 来编写DOM元素:</p>
<ol>
<li>方式一：template模板的方式;</li>
<li>方式二：render函数的方式，使用h函数来编写渲染的内容; </li>
<li>方式三：通过.vue文件中的template来编写模板;</li>
</ol>
</li>
<li><p>它们的模板分别是如何处理的呢?</p>
<ul>
<li>方式二中的h函数可以直接返回一个 <code>虚拟节点</code>，也就是 <code>Vnode节点</code>; </li>
<li>方式一和方式三的template都需要有特定的代码来对其进行解析:<ul>
<li>方式三.vue文件中的template可以通过在 <code>vue-loader</code> 对其进行编译和处理; </li>
<li>方式一种的 template 必须要<code>通过源码中一部分代码</code>来进行编译;</li>
</ul>
</li>
</ul>
</li>
<li><p>所以，Vue选择版本的时候分为 <code>运行时+编译器</code> vs <code>仅运行时</code></p>
<ul>
<li>运行时+编译器包含了对template模板的编译代码，更加完整，但是也更大一些; </li>
<li>仅运行时没有包含对template版本的编译代码，相对更小一些;</li>
</ul>
</li>
</ul>
<h2 id="修改引入模块">14.4. 修改引入模块</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue/dist/vue.esm-bundler&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;`</span>,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;Hello Vue&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="全局标识的配置">14.5. 全局标识的配置</h2><ul>
<li><p>控制台还有另外的一个警告: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runtime-core.esm-bundler.js:4947 Feature flags __VUE_OPTIONS_API__, __VUE_PROD_DEVTOOLS__ are not explicitly defined. You are running the esm-bundler build of Vue, <span class="built_in">which</span> expects these compile-time feature flags to be globally injected via the bundler config <span class="keyword">in</span> order to get better tree-shaking <span class="keyword">in</span> the production bundle.</span><br><span class="line"></span><br><span class="line">For more details, see https://link.vuejs.org/feature-flags.</span><br></pre></td></tr></table></figure>
</li>
<li><p>在GitHub上的文档中可以找到说明:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/vuejs/core/tree/main/packages/vue#bundler-build-feature-flags">https://github.com/vuejs/core/tree/main/packages/vue#bundler-build-feature-flags</a></p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Bundler Build Feature Flags</span><br><span class="line">Starting with 3.0.0-rc.3, esm-bundler builds now exposes global feature flags that can be overwritten at compile time:</span><br><span class="line"></span><br><span class="line"><span class="strong">__VUE<span class="emphasis">_OPTIONS_</span>API__</span> (enable/disable Options API support, default: true)</span><br><span class="line"><span class="strong">__VUE<span class="emphasis">_PROD_</span>DEVTOOLS__</span> (enable/disable devtools support in production, default: false)</span><br><span class="line">The build will work without configuring these flags, however it is strongly recommended to properly configure them in order to get proper tree-shaking in the final bundle. To configure these flags:</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这是两个特性的标识，一个是使用Vue的Options，一个是Production模式下是否支持devtools工具; </p>
</li>
<li><p>虽然他们都有默认值，但是强烈建议手动对他们进行配置;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">DefinePlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">            <span class="attr">BASE_URL</span>: <span class="string">&quot;&#x27;./&#x27;&quot;</span>,</span><br><span class="line">            <span class="attr">__VUE_OPTIONS_API__</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">__VUE_PROD_DEVTOOLS__</span>: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="VSCode对SFC文件的支持">14.6. VSCode对SFC文件的支持</h2><ul>
<li><p>真实开发中多数情况下我们都是使用SFC( <strong>single-file components (单文件组件)</strong> )。</p>
</li>
<li><p>VSCode对SFC的支持:</p>
<ul>
<li>插件一：<code>Vetur</code>，从Vue2开发就一直在使用的VSCode支持Vue的插件;</li>
<li>插件二：<code>Vue Language Features (Volar)</code>，官方推荐的插件(后续会基于Volar开发官方的VSCode插件);</li>
</ul>
</li>
</ul>
<h2 id="编写App-vue代码">14.7. 编写App.vue代码</h2><h3 id="src-vue-App-vue">14.7.1. src/vue/App.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                message: &#x27;Hello Vue&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    h2 &#123;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>



<h3 id="src-js-index-js">14.7.2. src/js/index.js</h3><p>引入App.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;../vue/App.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(app).<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="安装插件">14.7.3. 安装插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-loader@next -D</span><br></pre></td></tr></table></figure>



<h3 id="webpack-config-js">14.7.4. webpack.config.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="运行">14.7.5. 运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>错误信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="keyword">in</span> ./src/vue/App.vue</span><br><span class="line">Module Error (from ./node_modules/vue-loader/dist/index.js):</span><br><span class="line">vue-loader was used without the corresponding plugin. Make sure to include VueLoaderPlugin <span class="keyword">in</span> your webpack config.</span><br></pre></td></tr></table></figure>

<p>在 webpack.config.js 中引入  VueLoaderPlugin</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">VueLoaderPlugin</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vue-loader&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行之后还有错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="keyword">in</span> ./src/vue/App.vue?vue&amp;<span class="built_in">type</span>=style&amp;index=0&amp;<span class="built_in">id</span>=5e019a2f&amp;lang=css</span><br></pre></td></tr></table></figure>

<p>无法解析style中的css代码</p>
<p>在 webpack.config.js 中添加 css-loader,style-loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="css-scoped-原理">14.7.6. css scoped 原理</h3><p>当.vue 文件中的 style 标签有scoped 属性时，它的 css 样式 只作用于当前组件中的元素</p>
<p>css scoped 的 工作流程如下:</p>
<ol>
<li>使用 <code>vue-loader</code> 处理 .vue 文件，根据.vue文件的请求路径和文件内容，<code>生成 .vue 文件的hash值</code>, 如：89kjg85f；</li>
<li>如果.vue 文件的某一个style 标签有 scoped 属性，为.vue 文件<code>生成一个 scopedID</code>，scopedID 的格式为 <code>data-v-hash</code>， 如：data-v-89kjg85f；</li>
<li>使用 vue-loader 从.vue 文件中<code>获取style区域块</code>(scoped) 的样式内容(字符串) ；<ul>
<li>如果使用了 less 或者 sass，要使用 less-loader 或者 sass-loader 处理样式内容，使样式内容变为浏览器可识别的css样式；</li>
</ul>
</li>
<li>然后使用 <code>PostCSS</code> 提供的 parser 处理样式内容，为样式内容中的每一个 css选择器<code>添加 [data-v-hash]</code>；</li>
<li>再使用 <code>css-loader</code>；</li>
<li>最后使用 <code>style-loader</code> 把 css 样式添加到 head 中<ul>
<li>或者通过 miniCssExtractPlugin 将 css 样式 提取一个公共的 css 文件中</li>
</ul>
</li>
<li>经历上述过程，style(scoped)中的样式就变成了组件的私有样式</li>
</ol>
<h3 id="加载组件">14.7.7. 加载组件</h3><p><code>src/vue/Hello.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                message: &#x27;Hello Component&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    div&#123;</span><br><span class="line">        width: 200px;</span><br><span class="line">        height: 200px;</span><br><span class="line">        background-color: red;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p><code>src/vue/App.vue</code> 引入 <code>Hello.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;Hello&gt;&lt;/Hello&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Hello from &#x27;./Hello.vue&#x27;;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            Hello</span><br><span class="line">        &#125;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                message: &#x27;Hello Vue&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    h2 &#123;</span><br><span class="line">        color: red;</span><br><span class="line">        user-select: none;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>






<h1 id="搭建本地服务器">15. 搭建本地服务器</h1><ul>
<li>运行项目可以由两个操作:<ul>
<li>npm run build，编译相关的代码;</li>
<li>通过live server或者直接通过浏览器，打开index.html代码，查看效果;</li>
</ul>
</li>
<li>这个过程经常操作会影响开发效率，希望当文件发生变化时，可以自动的完成编译和展示;</li>
<li>为了完成自动编译，webpack提供了几种可选的方式: <ol>
<li>webpack watch mode; </li>
<li>webpack-dev-server(常用);</li>
<li>webpack-dev-middleware ;</li>
</ol>
</li>
</ul>
<h2 id="Webpack-watch">15.1. Webpack watch</h2><ul>
<li><p>webpack提供了watch模式:</p>
</li>
<li><p>在该模式下，webpack依赖图中的所有文件，只要有一个发生了更新，那么代码将被重新编译; </p>
</li>
<li><p>不需要手动去运行 npm run build指令了;</p>
</li>
<li><p>如何开启watch呢?</p>
<ol>
<li><p>方式一：在导出的配置中，添加 watch: true; </p>
</li>
<li><p>方式二：在启动webpack的命令中，添加 –watch的标识;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --watch&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>运行命名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run watch</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="webpack-dev-server">15.2. webpack-dev-server</h2><ul>
<li><p>watch 方式可以监听到文件的变化，但是事实上它本身是没有自动刷新浏览器的功能的: </p>
<ul>
<li>当然，可以在VSCode中使用live-server来完成这样的功能; </li>
<li>但是，在不适用live-server的情况下，可以具备live reloading(实时重新加载)的功能;</li>
</ul>
</li>
<li><p>安装webpack-dev-server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改配置文件，告知 dev server，从什么位置查找文件:</p>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 从什么位置查找文件</span></span><br><span class="line">    <span class="comment">// 查找 favicon.ico</span></span><br><span class="line">    <span class="attr">static</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;public&#x27;</span>)，</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>终端输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;i&gt; [webpack-dev-server] Project is running at:</span><br><span class="line">&lt;i&gt; [webpack-dev-server] Loopback: http://localhost:8080/</span><br><span class="line">&lt;i&gt; [webpack-dev-server] On Your Network (IPv4): http://192.168.0.190:8080/</span><br><span class="line">&lt;i&gt; [webpack-dev-server] On Your Network (IPv6): http://[fe80::1]:8080/</span><br><span class="line">&lt;i&gt; [webpack-dev-server] Content not from webpack is served from <span class="string">&#x27;xx/public&#x27;</span> directory</span><br><span class="line">asset js/index.js 755 KiB [emitted] (name: main) 1 related asset</span><br><span class="line">asset css/main.css 2.54 KiB [emitted] (name: main) 1 related asset</span><br><span class="line">asset index.html 686 bytes [emitted]</span><br><span class="line">Entrypoint main 758 KiB (819 KiB) = css/main.css 2.54 KiB js/index.js 755 KiB 2 auxiliary assets</span><br><span class="line">runtime modules 56.3 KiB 30 modules</span><br></pre></td></tr></table></figure>


</li>
<li><p>webpack-dev-server 在编译之后<code>不会写入到任何输出文件</code>。而是<code>将文件保留在内存中</code>: </p>
<ul>
<li>事实上webpack-dev-server使用了一个库叫memfs(memory-fs webpack自己写的)</li>
</ul>
</li>
</ul>
<h2 id="认识模块热替换-HMR">15.3. 认识模块热替换(HMR)</h2><ul>
<li><p>什么是HMR呢?</p>
</li>
<li><p>HMR的全称是Hot Module Replacement，翻译为模块热替换;</p>
</li>
<li><p>模块热替换是指在应用程序运行过程中，替换、添加、删除模块，而无需重新刷新整个页面;</p>
</li>
<li><p>HMR通过如下几种方式，来提高开发的速度:</p>
<ul>
<li>不重新加载整个页面，这样可以保留某些应用程序的状态不丢失;</li>
<li>只更新需要变化的内容，节省开发的时间;</li>
<li>修改了css、js源代码，会立即在浏览器更新，相当于直接在浏览器的devtools中直接修改样式;</li>
</ul>
</li>
<li><p>如何使用HMR呢?</p>
<ul>
<li>默认情况下，webpack-dev-server已经支持HMR，只需要开启即可; </li>
<li>在不开启HMR的情况下，修改了源代码之后，整个页面会自动刷新，使用的是live reloading;</li>
</ul>
</li>
</ul>
<h3 id="开启HMR">15.3.1. 开启HMR</h3><ul>
<li><p><code>webpack.config.js</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器终端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.</span><br><span class="line">[HMR] Waiting <span class="keyword">for</span> update signal from WDS...</span><br></pre></td></tr></table></figure>
</li>
<li><p>当修改某一个模块的代码时，依然是刷新的整个页面: </p>
<ul>
<li>这是因为需要去指定哪些模块发生更新时，进行HMR;</li>
</ul>
</li>
</ul>
<h3 id="案例">15.3.2. 案例</h3><p>在 src&#x2F;js 下新建 math.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>src&#x2F;js&#x2F;index.js    </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span>.<span class="property">hot</span>)&#123;</span><br><span class="line">    <span class="comment">// 一旦hot为true，说明开启了HMR功能，让代码生效</span></span><br><span class="line">    <span class="comment">// 方法会监听math.js文件的变化，一旦发生变化，其他默认不会重新打包构建</span></span><br><span class="line">    <span class="comment">// 执行回调函数</span></span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./math.js&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 math.js，浏览器终端输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Updated modules:</span><br><span class="line">[HMR]  - ./src/js/math.js</span><br><span class="line">[HMR] App is up to <span class="built_in">date</span>.</span><br></pre></td></tr></table></figure>



<h3 id="框架的HMR">15.3.3. 框架的HMR</h3><ul>
<li>在开发其他项目时，是否需要经常手动去写入 module.hot.accpet相关的API呢?<ul>
<li>比如开发Vue、React项目，我们修改了组件，希望进行热更新，这个时候应该如何去操作呢?</li>
<li>事实上社区已经针对这些有很成熟的解决方案了:</li>
<li>比如vue开发中，我们使用vue-loader，此loader支持vue组件的HMR，提供开箱即用的体验;</li>
<li>比如react开发中，有React Hot Loader，实时调整react组件(目前React官方已经弃用了，改成使用react- refresh);</li>
</ul>
</li>
</ul>
<p>修改App.vue，浏览器终端输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Updated modules:</span><br><span class="line">[HMR]  - ./src/vue/App.vue?vue&amp;<span class="built_in">type</span>=style&amp;index=0&amp;<span class="built_in">id</span>=5e019a2f&amp;scoped=<span class="literal">true</span>&amp;lang=css</span><br><span class="line">[HMR]  - ./src/vue/App.vue?vue&amp;<span class="built_in">type</span>=script&amp;lang=js</span><br><span class="line">[HMR]  - ./src/vue/App.vue</span><br><span class="line">[HMR]  - ./src/vue/App.vue?vue&amp;<span class="built_in">type</span>=template&amp;<span class="built_in">id</span>=5e019a2f&amp;scoped=<span class="literal">true</span></span><br><span class="line">[HMR] App is up to <span class="built_in">date</span>.</span><br><span class="line">jsonp chunk loading:502 Fetch finished loading: GET <span class="string">&quot;http://localhost:8080/main.b57ab62e8c566dbde0f1.hot-update.json&quot;</span>.</span><br><span class="line">__webpack_require__.hmrM @ jsonp chunk loading:502</span><br><span class="line">Promise.<span class="keyword">then</span> (async)</span><br><span class="line">hotCheck @ hot module replacement:246</span><br><span class="line">check @ dev-server.js:14</span><br><span class="line">(anonymous) @ dev-server.js:55</span><br><span class="line">emit @ events.js:153</span><br><span class="line">reloadApp @ reloadApp.js:46</span><br><span class="line">ok @ index.js:209</span><br><span class="line">(anonymous) @ socket.js:60</span><br><span class="line">client.onmessage @ WebSocketClient.js:50</span><br><span class="line">[HMR] Reload all css</span><br></pre></td></tr></table></figure>



<p>修改 Hello.vue，浏览器终端输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Updated modules:</span><br><span class="line">[HMR]  - ./src/vue/Hello.vue?vue&amp;<span class="built_in">type</span>=style&amp;index=0&amp;<span class="built_in">id</span>=10e6d2e0&amp;scoped=<span class="literal">true</span>&amp;lang=css</span><br><span class="line">[HMR]  - ./src/vue/Hello.vue?vue&amp;<span class="built_in">type</span>=script&amp;lang=js</span><br><span class="line">[HMR]  - ./src/vue/Hello.vue</span><br><span class="line">[HMR]  - ./src/vue/Hello.vue?vue&amp;<span class="built_in">type</span>=template&amp;<span class="built_in">id</span>=10e6d2e0&amp;scoped=<span class="literal">true</span></span><br><span class="line">[HMR] App is up to <span class="built_in">date</span>.</span><br><span class="line">[HMR] Reload all css</span><br></pre></td></tr></table></figure>



<h3 id="HMR的原理">15.3.4. HMR的原理</h3><ul>
<li><p>那么HMR的原理是什么呢？如何可以做到只更新一个模块中的内容呢?</p>
<ul>
<li>webpack-dev-server会创建两个服务：<code>提供静态资源的服务(express)</code> 和 <code>Socket服务(net.Socket)</code>;</li>
<li><code>express server</code>负责直接<code>提供静态资源的服务</code>(打包后的资源直接被浏览器请求和解析);</li>
</ul>
</li>
<li><p>HMR Socket Server，是一个socket的长连接:</p>
<ul>
<li>长连接有一个最好的好处是建立连接后<code>双方可以通信</code>(服务器可以直接发送文件到客户端); </li>
<li>当服务器监听到对应的模块发生变化时，会生成两个文件<code>.json</code>(manifest文件)和<code>.js</code>文件(update chunk); </li>
<li>通过长连接，可以直接将这两个文件<code>主动发送给客户端</code>(浏览器);</li>
<li>浏览器拿到两个新的文件后，通过HMR runtime机制，加载这两个文件，并且针对修改的模块进行更新;</li>
</ul>
</li>
</ul>
<h3 id="HMR原理图">15.3.5. HMR原理图</h3><p><img src="/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/hmr.png"></p>
<ul>
<li>Http连接：<ul>
<li>客户端发送http请求 -&gt; 和服务器建立连接 -&gt; 服务器做出响应 -&gt; 服务器断开连接</li>
</ul>
</li>
<li>Socket连接：<ul>
<li>即时通信：微信，聊天，直播</li>
<li>客户端和服务器之间存在一条通道，双方可以互发信息</li>
</ul>
</li>
</ul>
<h2 id="hotOnly、host配置">15.4. hotOnly、host配置</h2><ul>
<li><p>host设置主机地址:</p>
<ul>
<li>默认值是localhost; </li>
<li>如果希望其他地方也可以访问，可以设置为 0.0.0.0;</li>
</ul>
</li>
<li><p>localhost 和 0.0.0.0 的区别</p>
<ul>
<li>localhost：本质上是一个域名，通常情况下会被解析成127.0.0.1;</li>
<li>127.0.0.1：<code>回环地址</code>(Loop Back Address)，表达的意思其实是主机自己发出去的包，直接被自己接收;<ul>
<li>正常的数据库包经常 应用层 - 传输层 - 网络层 - 数据链路层 - 物理层 ;</li>
<li>而回环地址，是在网络层直接就被获取到了，是不会经常数据链路层和物理层的; </li>
<li>比如监听 127.0.0.1时，在同一个网段下的主机中，通过ip地址是不能访问的;</li>
</ul>
</li>
<li>0.0.0.0：监听IPV4上所有的地址，再根据端口找到不同的应用程序;<ul>
<li>比如监听 0.0.0.0时，在同一个网段下的主机中，通过ip地址是可以访问的;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="port、open、compress">15.5. port、open、compress</h2><ul>
<li><p>port设置监听的端口，默认情况下是8080</p>
</li>
<li><p>open是否打开浏览器:</p>
<ul>
<li>默认值是false，设置为true会打开浏览器; </li>
<li>也可以设置为类似于 Google Chrome等值;</li>
</ul>
</li>
<li><p>compress是否为静态文件开启gzip compression: </p>
<ul>
<li><p>默认值是false，可以设置为true;</p>
</li>
<li><p>设为true时，浏览器的请求头信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Host: localhost:3000</span><br><span class="line">Upgrade: websocket</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Proxy">15.6. Proxy</h2><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/#devserverproxy">https://webpack.docschina.org/configuration/dev-server/#devserverproxy</a></p>
<ul>
<li><p>proxy是开发中非常常用的一个配置选项，它的目的设置代理来<code>解决跨域访问</code>的问题: </p>
<ul>
<li>比如一个api请求是 <a href="http://localhost:8888，但是本地启动服务器的域名是">http://localhost:8888，但是本地启动服务器的域名是</a> <a href="http://localhost:8000，这个时候发送网络请求就会出现跨域的问题">http://localhost:8000，这个时候发送网络请求就会出现跨域的问题</a>;</li>
<li>那么可以将请求先发送到一个代理服务器，代理服务器和API服务器没有跨域的问题，就可以解决跨域问题了;</li>
</ul>
</li>
<li><p>进行如下的设置</p>
<ul>
<li><code>target</code>：表示的是代理到的目标地址，比如 &#x2F;api-hy&#x2F;moment会被代理到 <a target="_blank" rel="noopener" href="http://localhost:8888/api-hy/moment">http://localhost:8888/api-hy/moment</a>;</li>
<li><code>pathRewrite</code>：默认情况下，&#x2F;api-hy 也会被写入到URL中，如果希望删除，可以使用pathRewrite; </li>
<li><code>secure</code>：默认情况下不接收转发到https的服务器上，如果希望支持，可以设置为false;</li>
<li><code>changeOrigin</code>：它表示是否更新代理后请求的headers中host地址;</li>
</ul>
</li>
</ul>
<h3 id="案例-1">15.6.1. 案例</h3><p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">      <span class="attr">proxy</span>:&#123;</span><br><span class="line">          <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">              <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8000&#x27;</span>,</span><br><span class="line">              <span class="comment">// 不希望传递/api</span></span><br><span class="line">              <span class="attr">pathRewrite</span>: &#123; <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">              <span class="comment">// 默认情况下，将不接受在 HTTPS 上运行且证书无效的后端服务器</span></span><br><span class="line">              <span class="attr">secure</span>: <span class="literal">false</span>,</span><br><span class="line">              <span class="comment">// 默认情况下，代理时会保留主机头的来源，可以将 changeOrigin 设置为 true 以覆盖此行为</span></span><br><span class="line">              <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>安装axios</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i axios</span><br></pre></td></tr></table></figure>

<p>  在 <code>src/js/index.js</code> 中编写请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/test&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>新建node服务器</p>
<p>安装koa <code>npm i koa koa-router</code></p>
<p>编写服务  <code>src/js/node.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&quot;koa&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&quot;koa-router&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useRouter = <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;<span class="attr">prefix</span>:<span class="string">&quot;/test&quot;</span>&#125;);</span><br><span class="line">useRouter.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">ctx,next</span>)=&gt;</span>&#123;</span><br><span class="line">    ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">result</span>: [</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">uname</span>: <span class="string">&#x27;A&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">uname</span>: <span class="string">&#x27;B&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">uname</span>: <span class="string">&#x27;C&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">uname</span>: <span class="string">&#x27;D&#x27;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(useRouter.<span class="title function_">routes</span>());</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开启 koa 8000&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node src/js/node.js</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>浏览器输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;result: Array(4)&#125;</span><br></pre></td></tr></table></figure>



<h3 id="changeOrigin的解析">15.6.2. changeOrigin的解析</h3><ul>
<li>这个 changeOrigin官方说的非常模糊，通过查看源码发现其实是要修改代理请求中的headers中的host属性:<ul>
<li>因为真实的请求，其实是需要通过 <a href="http://localhost:8888来请求的">http://localhost:8888来请求的</a>;</li>
<li>但是因为使用了代码，默认情况下它的值时 <a target="_blank" rel="noopener" href="http://localhost:8000/">http://localhost:8000</a>;</li>
<li>如果需要修改，那么可以将changeOrigin设置为true即可</li>
</ul>
</li>
</ul>
<h3 id="源码">15.6.3. 源码</h3><p>node_modules&#x2F;http-proxy&#x2F;lib&#x2F;http-proxy&#x2F;common.js 中添加打印信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.<span class="property">changeOrigin</span>) &#123;</span><br><span class="line">   outgoing.<span class="property">headers</span>.<span class="property">host</span> = required(outgoing.<span class="property">port</span>, options[forward || <span class="string">&#x27;target&#x27;</span>].<span class="property">protocol</span>) &amp;&amp; !<span class="title function_">hasPort</span>(outgoing.<span class="property">host</span>)? outgoing.<span class="property">host</span> + <span class="string">&#x27;:&#x27;</span> + outgoing.<span class="property">port</span>: outgoing.<span class="property">host</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;=====changeOrigin======&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(outgoing);</span><br></pre></td></tr></table></figure>

<p>设置不同，host值不同</p>
<p> <code>changeOrigin: false</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">=====changeOrigin======</span><br><span class="line">&#123;</span><br><span class="line">  port: <span class="string">&#x27;8000&#x27;</span>,</span><br><span class="line">  host: <span class="string">&#x27;localhost:8000&#x27;</span>,</span><br><span class="line">  hostname: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;accept-encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>,</span><br><span class="line">    referer: <span class="string">&#x27;http://localhost:3000/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-fetch-dest&#x27;</span>: <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-fetch-mode&#x27;</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-fetch-site&#x27;</span>: <span class="string">&#x27;same-origin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua-platform&#x27;</span>: <span class="string">&#x27;&quot;macOS&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua-mobile&#x27;</span>: <span class="string">&#x27;?0&#x27;</span>,</span><br><span class="line">    accept: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot;Chromium&quot;;v=&quot;104&quot;, &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;104&quot;&#x27;</span>,</span><br><span class="line">    connection: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    host: <span class="string">&#x27;localhost:3000&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  agent: <span class="literal">false</span>,</span><br><span class="line">  localAddress: undefined,</span><br><span class="line">  path: <span class="string">&#x27;/test&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>changeOrigin: true</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">=====changeOrigin======</span><br><span class="line">&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    host: <span class="string">&#x27;localhost:8000&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="historyApiFallback">15.7. historyApiFallback</h2><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/#devserverhistoryapifallback">https://webpack.docschina.org/configuration/dev-server/#devserverhistoryapifallback</a></p>
<ul>
<li><p>historyApiFallback是开发中一个非常常见的属性，它主要的作用是解决SPA页面在路由跳转之后，进行页面刷新时，返回404的错误</p>
</li>
<li><p>boolean值</p>
<ul>
<li><p>默认是false </p>
</li>
<li><p>如果设置为true，那么在刷新时，返回404错误时，会自动返回 index.html 的内容;</p>
</li>
</ul>
</li>
<li><p>object类型的值，可以配置rewrites属性:</p>
<ul>
<li>可以配置from来匹配路径，决定要跳转到哪一个页面;</li>
</ul>
</li>
<li><p>事实上devServer中实现historyApiFallback功能是通过connect-history-api-fallback库的: </p>
<ul>
<li>可以查看 <a target="_blank" rel="noopener" href="https://github.com/bripkens/connect-history-api-fallback">connect-history-api-fallback</a> 文档</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">historyApiFallback</span>: &#123;</span><br><span class="line">      <span class="attr">rewrites</span>: [</span><br><span class="line">        &#123; <span class="attr">from</span>: <span class="regexp">/^\/$/</span>, <span class="attr">to</span>: <span class="string">&#x27;/views/landing.html&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">from</span>: <span class="regexp">/^\/subpage/</span>, <span class="attr">to</span>: <span class="string">&#x27;/views/subpage.html&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">from</span>: <span class="regexp">/./</span>, <span class="attr">to</span>: <span class="string">&#x27;/views/404.html&#x27;</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h1 id="resolve模块解析">16. resolve模块解析</h1><ul>
<li><p>resolve用于设置模块如何被解析:</p>
</li>
<li><p>在开发中会有各种各样的模块依赖，这些模块可能来自于自己编写的代码，也可能来自第三方库; </p>
</li>
<li><p>resolve可以帮助webpack从每个 require&#x2F;import 语句中，找到需要引入到合适的模块代码;</p>
</li>
<li><p>webpack 使用 <a target="_blank" rel="noopener" href="https://github.com/webpack/enhanced-resolve">enhanced-resolve</a> 来解析文件路径;</p>
</li>
<li><p>webpack能解析三种文件路径:</p>
<ul>
<li><code>绝对路径</code><ul>
<li>由于已经获得文件的绝对路径，因此不需要再做进一步解析。</li>
</ul>
</li>
<li><code>相对路径</code><ul>
<li>在这种情况下，使用 import 或 require 的资源文件所处的目录，被认为是上下文目录; </li>
<li>在 import&#x2F;require 中给定的相对路径，会拼接此上下文路径，来生成模块的绝对路径;</li>
</ul>
</li>
<li><code>模块路径</code><ul>
<li>在 resolve.modules中指定的所有目录检索模块;<ul>
<li>默认值是 [‘node_modules’]，所以默认会从node_modules中查找文件;</li>
</ul>
</li>
<li>可以通过设置别名的方式来替换初识模块路径，通过alias的配置;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="确实文件还是文件夹">16.1. 确实文件还是文件夹</h2><ul>
<li><p>如果是一个文件:</p>
</li>
<li><p>如果文件具有扩展名，则直接打包文件;</p>
</li>
<li><p>否则，将使用 resolve.extensions 选项作为文件扩展名解析;</p>
</li>
<li><p>如果是一个文件夹:</p>
</li>
<li><p>会在文件夹中根据 resolve.mainFiles配置选项中指定的文件顺序查找;</p>
<ul>
<li>resolve.mainFiles的默认值是 [‘index’]; </li>
<li>再根据 resolve.extensions来解析扩展名;</li>
</ul>
</li>
</ul>
<h2 id="extensions和alias配置">16.2. extensions和alias配置</h2><ul>
<li><p>extensions是解析到文件时自动添加扩展名:</p>
</li>
<li><p>默认值是 [‘.wasm’, ‘.mjs’, ‘.js’, ‘.json’];</p>
</li>
<li><p>如果代码中想要添加加载 .vue 或者 jsx 或者 ts 等文件时，必须自己写上扩展名;</p>
</li>
<li><p>另一个非常好用的功能是配置别名alias: </p>
<ul>
<li>特别是当我们项目的目录结构比较深的时候，或者一个文件的路径可能需要 ..&#x2F;..&#x2F;..&#x2F;这种路径片段; </li>
<li>可以给某些常见的路径起一个别名;</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>,<span class="string">&#x27;.ts&#x27;</span>,<span class="string">&#x27;.jsx&#x27;</span>],</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">            <span class="attr">public</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;public&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，可以在代码中使用 alias</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;@/vue/App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&#x27;@/js/math&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h1 id="不同开发环境">17. 不同开发环境</h1><h2 id="区分不同开发环境">17.1. 区分不同开发环境</h2><ul>
<li><p>目前所有的webpack配置信息都是放到一个配置文件中的：webpack.config.js</p>
<ul>
<li>当配置越来越多时，这个文件会变得越来越不容易维护;</li>
<li>并且某些配置是在开发环境需要使用的，某些配置是在生成环境需要使用的，当然某些配置是在开发和生成环 境都会使用的;</li>
<li>所以，最好对配置进行划分，方便维护和管理;</li>
</ul>
</li>
<li><p>那么，在启动时如何可以区分不同的配置呢?</p>
</li>
</ul>
<ol>
<li>方案一：编写两个不同的配置文件，开发和生成时，分别加载不同的配置文件即可; </li>
<li>方式二：使用相同的一个入口配置文件，通过设置参数来区分它们;</li>
</ol>
<h2 id="不同配置文件">17.2. 不同配置文件</h2><p>根目录下新建 config 文件夹，并创建三个配置文件</p>
<ul>
<li>webpack.comm.conf.js </li>
<li>webpack.dev.conf.js</li>
<li>webpack.prod.conf.js</li>
</ul>
<p>修改 package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config ./config/webpack.prod.config.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve --config ./config/webpack.dev.config.js&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-merge -D</span><br></pre></td></tr></table></figure>



<h2 id="webpack-comm-config-js">17.3. webpack.comm.config.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">DefinePlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">VueLoaderPlugin</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vue-loader/dist/index&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;js/index.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;../build&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="comment">// &#x27;style-loader&#x27;,</span></span><br><span class="line">                    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;public/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Hello Vue&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;css/main.css&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">            <span class="attr">BASE_URL</span>: <span class="string">&quot;&#x27;./&#x27;&quot;</span>,</span><br><span class="line">            <span class="attr">__VUE_OPTIONS_API__</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">__VUE_PROD_DEVTOOLS__</span>: <span class="literal">false</span></span><br><span class="line">        &#125;),</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()</span><br><span class="line">    ],</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>,<span class="string">&#x27;.ts&#x27;</span>,<span class="string">&#x27;.jsx&#x27;</span>],</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;../src&#x27;</span>),</span><br><span class="line">            <span class="attr">public</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&quot;../public&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="webpack-dev-config-js">17.4. webpack.dev.config.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.comm.config&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig,&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">static</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;../public&#x27;</span>),</span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">proxy</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8000&#x27;</span>,</span><br><span class="line">                <span class="comment">// 不希望传递/api</span></span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123; <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">                <span class="comment">// 默认情况下，将不接受在 HTTPS 上运行且证书无效的后端服务器</span></span><br><span class="line">                <span class="attr">secure</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="comment">// 默认情况下，代理时会保留主机头的来源，可以将 changeOrigin 设置为 true 以覆盖此行为</span></span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="webpack-prod-config-js">17.5. webpack.prod.config.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">CleanWebpackPlugin</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;copy-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.comm.config&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig,&#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">patterns</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">from</span>: <span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;../public&#x27;</span>),</span><br><span class="line">                    <span class="attr">globOptions</span>: &#123;</span><br><span class="line">                        <span class="attr">ignore</span>: [</span><br><span class="line">                            <span class="string">&#x27;**/.DS_Store&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;**/index.html&#x27;</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="开发环境">17.6. 开发环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>



<h2 id="生产环境">17.7. 生产环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <div>      <div>
    
        <div style="margin-top:30px;padding-top:20px;border-top: 1px dashed #b3a9a7;text-align:center;color: #ccc;font-size:20px;">本文结束&nbsp;<i class="fa fa-paw"></i>&nbsp;感谢您的阅读</div>
    
</div>  </div>
        

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Wang Ting
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <!-- <a href="https://wtlumos.github.io/zh-CN/2020/10/05/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003-webpack%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/" title="Vue学习笔记03-webpack搭建Vue环境">https://wtlumos.github.io/zh-CN/2020/10/05/Vue学习笔记03-webpack搭建Vue环境/</a> -->
    
       <a href ="/zh-CN/2020/10/05/Vue学习笔记03-webpack搭建Vue环境/" >/zh-CN/2020/10/05/Vue学习笔记03-webpack搭建Vue环境/</a>
  </li>
       <li>
          <strong>发布时间：</strong>
          2020-10-05 16:16
      </li>
      <li>
          <strong>更新时间：</strong>
          2023-04-15 16:17

      </li>
  
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/js/" rel="tag"><i class="fa fa-tag"></i> js</a>
              <a href="/tags/Vue/" rel="tag"><i class="fa fa-tag"></i> Vue</a>
              <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i> webpack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/zh-CN/2020/10/06/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B005-Vite%E6%90%AD%E5%BB%BAVue%E7%8E%AF%E5%A2%83/" rel="prev" title="Vue学习笔记05-Vite搭建Vue环境">
      <i class="fa fa-chevron-left"></i> Vue学习笔记05-Vite搭建Vue环境
    </a></div>
      <div class="post-nav-item">
    <a href="/zh-CN/2020/10/03/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B002-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/" rel="next" title="Vue学习笔记02-模板语法">
      Vue学习笔记02-模板语法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5"><span class="nav-text">1. 基础认知</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2"><span class="nav-text">1.1. Webpack到底是什么呢?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack%E7%9A%84%E4%BD%BF%E7%94%A8%E5%89%8D%E6%8F%90"><span class="nav-text">1.2. Webpack的使用前提</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-text">1.3. Webpack的安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack%E7%9A%84%E9%BB%98%E8%AE%A4%E6%89%93%E5%8C%85"><span class="nav-text">1.4. Webpack的默认打包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%A3%E7%A0%81"><span class="nav-text">2. 实验代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BApackage-json%E6%96%87%E4%BB%B6"><span class="nav-text">2.1. 创建package.json文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85webpack"><span class="nav-text">2.2. 安装webpack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6"><span class="nav-text">2.3. 创建文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAscripts%E8%84%9A%E6%9C%AC"><span class="nav-text">2.4. 创建scripts脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="nav-text">2.5. 执行脚本命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Webpack%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">3. Webpack配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">4. 指定配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Webpack%E7%9A%84%E4%BE%9D%E8%B5%96%E5%9B%BE"><span class="nav-text">5. Webpack的依赖图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vue%E9%A1%B9%E7%9B%AE%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%E6%9C%89%E5%93%AA%E4%BA%9B%E5%91%A2"><span class="nav-text">6. Vue项目加载的文件有哪些呢?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">7. 编写案例代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#css-loader%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">7.1. css-loader的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#css-loader%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%A1%88"><span class="nav-text">7.2. css-loader的使用方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E8%81%94%E6%96%B9%E5%BC%8F"><span class="nav-text">7.2.1. 内联方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLI%E6%96%B9%E5%BC%8F"><span class="nav-text">7.2.2. CLI方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">7.2.3. 配置方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#style-loader"><span class="nav-text">7.3. style-loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85style-loader"><span class="nav-text">7.3.1. 安装style-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEstyle-loader"><span class="nav-text">7.3.2. 配置style-loader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86less%E6%96%87%E4%BB%B6"><span class="nav-text">7.4. 如何处理less文件?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Less%E5%B7%A5%E5%85%B7%E5%A4%84%E7%90%86"><span class="nav-text">7.4.1. Less工具处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#less-loader%E5%A4%84%E7%90%86"><span class="nav-text">7.4.2. less-loader处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PostCSS-%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="nav-text">8. PostCSS 兼容性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8postcss"><span class="nav-text">8.1. 命令行使用postcss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6autoprefixer"><span class="nav-text">8.2. 插件autoprefixer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#postcss-loader"><span class="nav-text">8.3. postcss-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%8B%AC%E7%9A%84postcss%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">8.4. 单独的postcss配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#postcss-preset-env"><span class="nav-text">8.5. postcss-preset-env</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E5%9B%BE%E7%89%87"><span class="nav-text">9. 打包图片</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#file-loader"><span class="nav-text">9.1. file-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-text">9.2. 文件的命名规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-text">9.3. 设置文件的名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%98%E6%94%BE%E8%B7%AF%E5%BE%84"><span class="nav-text">9.4. 设置文件的存放路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url-loader"><span class="nav-text">9.5. url-loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85url-loader"><span class="nav-text">9.5.1. 安装url-loader:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">9.5.2. 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url-loader%E7%9A%84limit"><span class="nav-text">9.5.3. url-loader的limit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#asset-module-type"><span class="nav-text">9.6. asset module type</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-text">9.6.1. 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url-loader%E7%9A%84limit%E6%95%88%E6%9E%9C"><span class="nav-text">9.6.2. url-loader的limit效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E5%AD%97%E4%BD%93"><span class="nav-text">10. 打包字体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="nav-text">10.1. 加载字体文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E4%BD%93%E7%9A%84%E6%89%93%E5%8C%85"><span class="nav-text">10.2. 字体的打包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Plugin"><span class="nav-text">11. Plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CleanWebpackPlugin"><span class="nav-text">11.1. CleanWebpackPlugin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HtmlWebpackPlugin"><span class="nav-text">11.2. HtmlWebpackPlugin</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90index-html%E5%88%86%E6%9E%90"><span class="nav-text">11.2.1. 生成index.html分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89HTML%E6%A8%A1%E6%9D%BF"><span class="nav-text">11.2.2. 自定义HTML模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E6%95%B0%E6%8D%AE%E5%A1%AB%E5%85%85"><span class="nav-text">11.2.3. 自定义模板数据填充</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DefinePlugin"><span class="nav-text">11.2.4. DefinePlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%9A%84index-html"><span class="nav-text">11.2.5. 生成的index.html</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CopyWebpackPlugin"><span class="nav-text">11.3. CopyWebpackPlugin</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mode%E9%85%8D%E7%BD%AE"><span class="nav-text">12. Mode配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mode-development"><span class="nav-text">12.1. Mode: development</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mode-production"><span class="nav-text">12.2. Mode: production</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mode-none"><span class="nav-text">12.3. Mode: none</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Babel"><span class="nav-text">13. Babel</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81babel"><span class="nav-text">13.1. 为什么需要babel?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8"><span class="nav-text">13.2. Babel命令行使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">13.3. 插件的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel%E7%9A%84%E9%A2%84%E8%AE%BEpreset"><span class="nav-text">13.4. Babel的预设preset</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-text">13.5. Babel的底层原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel%E7%BC%96%E8%AF%91%E5%99%A8%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="nav-text">13.6. Babel编译器执行原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babel-loader"><span class="nav-text">13.7. babel-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8F%92%E4%BB%B6"><span class="nav-text">13.8. 指定使用的插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babel-preset"><span class="nav-text">13.9. babel-preset</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">13.10. Babel的配置文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vue%E6%89%93%E5%8C%85"><span class="nav-text">14. Vue打包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Vue%E6%BA%90%E7%A0%81%E7%9A%84%E6%89%93%E5%8C%85"><span class="nav-text">14.1. Vue源码的打包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vue%E6%89%93%E5%8C%85%E5%90%8E%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E8%A7%A3%E6%9E%90"><span class="nav-text">14.2. Vue打包后不同版本解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6-%E7%BC%96%E8%AF%91%E5%99%A8-vs-%E4%BB%85%E8%BF%90%E8%A1%8C%E6%97%B6"><span class="nav-text">14.3. 运行时+编译器 vs 仅运行时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%BC%95%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="nav-text">14.4. 修改引入模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E6%A0%87%E8%AF%86%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text">14.5. 全局标识的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VSCode%E5%AF%B9SFC%E6%96%87%E4%BB%B6%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-text">14.6. VSCode对SFC文件的支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99App-vue%E4%BB%A3%E7%A0%81"><span class="nav-text">14.7. 编写App.vue代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#src-vue-App-vue"><span class="nav-text">14.7.1. src&#x2F;vue&#x2F;App.vue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#src-js-index-js"><span class="nav-text">14.7.2. src&#x2F;js&#x2F;index.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="nav-text">14.7.3. 安装插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-config-js"><span class="nav-text">14.7.4. webpack.config.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-text">14.7.5. 运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#css-scoped-%E5%8E%9F%E7%90%86"><span class="nav-text">14.7.6. css scoped 原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E7%BB%84%E4%BB%B6"><span class="nav-text">14.7.7. 加载组件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">15. 搭建本地服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-watch"><span class="nav-text">15.1. Webpack watch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-dev-server"><span class="nav-text">15.2. webpack-dev-server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A4%E8%AF%86%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2-HMR"><span class="nav-text">15.3. 认识模块热替换(HMR)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AFHMR"><span class="nav-text">15.3.1. 开启HMR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-text">15.3.2. 案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E7%9A%84HMR"><span class="nav-text">15.3.3. 框架的HMR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HMR%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-text">15.3.4. HMR的原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HMR%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="nav-text">15.3.5. HMR原理图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hotOnly%E3%80%81host%E9%85%8D%E7%BD%AE"><span class="nav-text">15.4. hotOnly、host配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#port%E3%80%81open%E3%80%81compress"><span class="nav-text">15.5. port、open、compress</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxy"><span class="nav-text">15.6. Proxy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="nav-text">15.6.1. 案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#changeOrigin%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="nav-text">15.6.2. changeOrigin的解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81"><span class="nav-text">15.6.3. 源码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#historyApiFallback"><span class="nav-text">15.7. historyApiFallback</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#resolve%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90"><span class="nav-text">16. resolve模块解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9E%E6%96%87%E4%BB%B6%E8%BF%98%E6%98%AF%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-text">16.1. 确实文件还是文件夹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#extensions%E5%92%8Calias%E9%85%8D%E7%BD%AE"><span class="nav-text">16.2. extensions和alias配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-text">17. 不同开发环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E5%88%86%E4%B8%8D%E5%90%8C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-text">17.1. 区分不同开发环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">17.2. 不同配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-comm-config-js"><span class="nav-text">17.3. webpack.comm.config.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-dev-config-js"><span class="nav-text">17.4. webpack.dev.config.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-prod-config-js"><span class="nav-text">17.5. webpack.prod.config.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-text">17.6. 开发环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83"><span class="nav-text">17.7. 生产环境</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wang Ting"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Wang Ting</p>
  <div class="site-description" itemprop="description">技术成长笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">381</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/WTlumos" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;WTlumos" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/7807823198" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7807823198" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-glasses fa-fw"></i>
      最近阅读
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.bilibili.com/video/av77638697/" title="https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;av77638697&#x2F;" rel="noopener" target="_blank">浙江大学-研究生机器学习课程</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang Ting</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span>网站总字数: </span>
    <span title="站点总字数">2.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
        <span>阅读总时长: </span>
    <span title="站点阅读时长">44:22</span>
</div>

<span id="sitetime"></span>

<script language=javascript>
  function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000;
    var minutes = seconds * 60;
    var hours = minutes * 60;
    var days = hours * 24;
    var years = days * 365;
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
    year - 作为date对象的年份，为4位年份值
    month - 0-11之间的整数，做为date对象的月份
    day - 1-31之间的整数，做为date对象的天数
    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
    minutes - 0-59之间的整数，做为date对象的分钟数
    seconds - 0-59之间的整数，做为date对象的秒数
    microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    var t1 = Date.UTC(2018,07,01,00,00,00); //北京时间2018-07-01 00:00:00
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = t2-t1;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);

    if(window.location.pathname=='/en/'){
           document.getElementById("sitetime").innerHTML=" Run for "+ diffYears+" Year "+ diffDays+" Days "+diffHours+" Hours "+diffMinutes+" Minute "+diffSeconds+" Second";
    }else{
          document.getElementById("sitetime").innerHTML=" 已运行 "+ diffYears+" 年 "+ diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
    }

  }
  siteTime();
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'fb5f16fdf7649a9e5208',
      clientSecret: 'bcd95c87cdbab8fa32fc1b006fbb1ce7e8ffae5b',
      repo        : 'wtlumos.github.io',
      owner       : 'WTlumos',
      admin       : ['WTlumos'],
      id          : 'e4330777ec8f7fc8735d64985068c0fb',
        language: '',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":125,"height":290,"hOffset":-15,"vOffset":-40},"mobile":{"show":true,"scale":0.5},"react":{"opacity":0.7},"dialog":{"enable":false,"hitokoto":false},"log":false});</script></body>
</html>
